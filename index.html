<!doctype html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Voice Maker - Create a Voice - Online &amp; Free</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- <link rel="manifest" href="site.webmanifest"> -->

    <!-- <link rel="apple-touch-icon" href="apple-touch-icon.png"> -->
    <!-- Place favicon.ico in the root directory -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/css/normalize-5.0.0.css">

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>
  <body>
    <!--[if lt IE 8]>
        <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #efefef;
    }
    html {
      box-sizing: border-box;
    }
    *, *:before, *:after {
      box-sizing: inherit;
    }
    .voice-ctn {
      background:white;
      border-radius:1px;
      box-shadow: 0 1px 3px 0 rgba(0,0,0,.14);
    }
    .voice-ctn .header {
      border-bottom: 1px solid lightgrey;
      padding: 0.5rem;
    }
    #inputOutputArea {
      width: 900px;
      margin: 0 auto;
    }
    @media screen and (max-width: 960px) {
      .voice-ctn button { padding:0.4rem; font-size:0.8rem; }
      #inputOutputArea {
        flex-direction: column;
        width: unset;
        margin: unset;
      }
    }
      
    .blink {
      animation: blinker 1s step-start infinite;
    }
    @keyframes blinker {
      50% {
        color: orange;
      }
    }
    </style>

    <section style="background: #ffc760;display:flex;">
      <div style="font-size: 90%; padding: 0.5rem;"><b>Some news!</b> I created this site as a small hobby project, but now I'm working on a full-featured, AI-powered, <i>real-time</i> voice changer that'll work with Discord, Zoom, and all your other apps &amp; games. If you want to be one of the first to get access during the beta, you can <a href="https://forms.gle/E9M2LYicuHcgNpuF7" target="_blank">join the waitlist</a>.</div>
    </section>


    <main style="display:flex; flex-direction:column;">
      
      <div style="text-align:center; margin:0; margin-top:1rem; text-align:center; font-size:90%; color:#9a9a9a"><a href="https://voicechanger.io" target="_blank" style="text-decoration:none; color:inherit;">voicechanger.io</a></div>
      <h1 id="header" style="text-align:center; margin:0; padding:1rem; padding-top: 1rem;"><span id="voiceName"></span>Voice Maker</h1>
      <div id="subtitle" style="text-align:center; padding-bottom: 1.5rem; padding-top: 0;">Combine audio effects to create your own unique voices!</div>
      <div id="inputOutputArea" style="display:flex; padding:0.5rem; min-height:130px;">

        <div id="inputArea" style="flex:1; margin: 0.5rem;">
          <div class="voice-ctn" style="display:flex; flex-direction:column; height:100%;">
            <div class="header" style="text-align:center; font-weight:bold;">Input Audio</div>
            <div style="text-align:center; flex-grow:1; display:flex; min-height: 100px;">
              <div style="margin:auto; position:relative;">
                <div style="margin-bottom: 0.5rem;"><a style="color:#c55c00" href="https://voicegenerator.io" target="_blank">text-to-speech</a></div>
                <button id="microphone-button" style="padding: 0.5rem;" onclick="recordFromMicrophone();">
                  <span class="start">üéô record a clip</span><span class="mic-enable" style="display:none;">please enable microphone</span><span class="stop" style="display:none;">(<span class="time"></span>) stop recording</span>
                </button>
                <div style="position:relative; overflow:hidden; display:inline-block; cursor:pointer; vertical-align:top;">
                  <button style="padding: 0.5rem;">üìÅ load a clip</button>
                  <input accept="audio/*,video/*" onchange="loadAudioFile(this.files[0]);" style="cursor:pointer; z-index:5; position:absolute; top:0; left:0; bottom:0; right:0; opacity:0;" type="file" />
                </div>
                <div style="font-size:85%; opacity:0.8; margin-top:0.5rem;">Example clips: <span style="cursor:pointer; text-decoration:underline;" onclick="loadExampleAudio('female')">female</span> or <span style="cursor:pointer; text-decoration:underline;" onclick="loadExampleAudio('male')">male</span></div>
                <div id="audio-load-success" style="z-index:10; color: black; text-align: center;position: absolute;top: 0;left: 0;right: 0;bottom: 0;background: #ffffff;margin: 0; display:none;">
                  <div style="margin:auto;">
                    <p style="margin-top: 0;margin-bottom: 0.3rem;">Success!</p>
                    <button onclick="this.parentNode.parentNode.style.display='none'">change input</button>
                  </div>
                </div>
                <div id="audio-loading-input" style="z-index:10; color: black; text-align: center;position: absolute;top: 0;left: 0;right: 0;bottom: 0;background: #ffffff;margin: 0; display:none;">
                  <div style="margin:auto;">
                    <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="outputArea" style="flex:1; margin: 0.5rem;">
          <div class="output-voice-ctn voice-ctn" style="display:flex; flex-direction:column; height:100%; opacity:0.3;">
            <div id="voice-output-loader" style="display:none; margin:auto; text-align:center; padding: 1rem;">
              <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
              <div style="font-size: 80%;">This could take a while...</div>
              <div style="font-size:65%; opacity: 0.6; margin-top: 0.1rem;" id="effectLoadProgressMessage">applying effect 1/1</div>
            </div>
            <div id="voice-output-area" style="display:flex; flex-direction:column;">
              <div class="header" style="text-align:center; font-weight:bold;">Output Audio</div>
              <div style="text-align:center; flex-grow:1; margin:1rem 0;">
                <audio id="output-audio-tag" controls></audio>
                <br><button id="regenerateAudioButton" style="margin:0 auto; margin-bottom: 0.3rem;" onclick="loadOutputAudio();">re-generate</button>
                <a style="margin: 0 auto; width: min-content;" href="#" id="download-output-audio-link" download="output.wav"><button>download</button></a>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div id="effectsAdder" style="text-align:center;">
        <select id="effectsAdderSelect" onchange="if(this.value == 'RANDOM') { makeRandomVoice() } else if(this.value) { addEffect(this.value, null, 'start'); updateEffectsData(); } this.value='';" style="padding: 1rem 2rem;"></select>
      </div>

      <style>
      #effectsList {
        width: 95%;
        max-width: 600px;
        margin:0 auto;
      }
      .effect {
        box-shadow: 0 1px 3px 0 rgba(0,0,0,.14);
        background:white;
        margin-top:1rem;
      }
      .effect .header {
        display:flex;
        border-bottom: 1px solid lightgrey;
        padding:0.8rem;
        position:relative;
      }
      .effect .header .title {
        flex-grow:1;
        font-weight:bold;
        line-height: 1.2rem;
      }
      .effect .header .handle {
        cursor: move;
      }
      .effect .header .icon {
        padding: 0 5px;
        border: 1px solid black;
        opacity:0.4;
        border-radius:2px;
      }
      .effect .header .icon:hover {
        background:#e4e4e4;
      }
      .effect .description {
        border-bottom: 1px solid lightgrey;
        padding:0.8rem;
      }
      .effect .params {
        padding:0.8rem;
      }
      .effect .param {
        display:flex;
      }
      .effect .param .input-wrapper {
        flex-grow:1;
        display: flex;
      }
      .effect .param .name {
        padding: 0.2rem;
      }
      .effect .param input, #effectsList .effect .param select {
        width:100%;
      }
      .effect .param:not(:first-child) {
        margin-top: 0.4rem;
      }


      .effect .title-menu {
        padding: 5px 0px;
        position: absolute;
        background: #fff;
        box-shadow: 0 4px 12px 1px rgba(0,0,0,.14);
        border-radius: 3px;
        z-index: 10;
        right: 0;
        top: 0;
        display: none;
      }
      .effect .title-menu.visible {
        display: block;
      }
      .effect .title-menu .menu-item {
        padding: 8px 16px;
        line-height: 24px;
        cursor: pointer;
      }
      .effect .title-menu .menu-item:hover {
        background: #f2f4f6;
      }

      .range-param-display:hover {
        background: #f3f3f3;
      }
      </style>


      <script>
      window.visibleTransformTitleMenu = null;
      window.addEventListener('click', function(e) {
        if(window.visibleTransformTitleMenu) {
          window.visibleTransformTitleMenu.classList.remove("visible");
          visibleTransformTitleMenu = null;
        }
      });
      </script>


      <div id="loadingEffectsNotice" style=" text-align: center; margin-top: 2rem; font-weight: bold; font-size: 3rem;">Loading...</div>

      <div id="effectsList" style="min-height:100px;"></div>

      <div style="width:250px;margin:0 auto;margin-top: 2rem;text-align: center;">
        <div style="margin-bottom: 0.5em;">Share your voice changer:</div>
        <div style="display:flex;width: 100%;height: 2.1rem;">
          <input style="height:100%; flex-grow:1;" id="urlInputEl" type="text" value="">
          <button style="cursor:pointer; height:100%;width: max-content;" onclick="copyTextToClipboard(urlInputEl.value); this.innerText='copied!'; setTimeout(() => this.innerText='copy', 1500)">copy</button>
        </div>
      </div>
      <script>
      urlInputEl.value = window.location.href;

      // https://stackoverflow.com/a/33928558/10898116
      function copyTextToClipboard(text) {
          if (window.clipboardData && window.clipboardData.setData) {
              // IE specific code path to prevent textarea being shown while dialog is visible.
              return clipboardData.setData("Text", text);

          } else if (document.queryCommandSupported && document.queryCommandSupported("copy")) {
              var textarea = document.createElement("textarea");
              textarea.textContent = text;
              textarea.style.position = "fixed";  // Prevent scrolling to bottom of page in MS Edge.
              document.body.appendChild(textarea);
              textarea.select();
              try {
                  return document.execCommand("copy");  // Security exception may be thrown by some browsers.
              } catch (ex) {
                  console.warn("Copy to clipboard failed.", ex);
                  return false;
              } finally {
                  document.body.removeChild(textarea);
              }
          }
      }
      </script>

      <img style="display:block; margin:2rem auto; opacity:0.7;" src="/voicemaker/img/flourish.png" />

      <div style="box-shadow: 0 1px 3px 0 rgba(0,0,0,.14);background: white;padding: 1rem;margin: 0 auto; max-width: 600px; width:95%; box-sizing: border-box;">
        <p style="text-align: center; margin: 0;"><b>Notes</b></p>
        <ul style="margin-bottom: 0; margin-top: 0.5rem;">
          <li>Add effects with the drop-down list. Drag the "‚Üï" icon to re-order them.</li>
          <li>Copy the URL of this page to share your creation! üéâ</li>
          <!-- <li>Made a cool voice? Share the link with everyone else <a href="http://upli.st/l/voicemaker-voices">here</a> :)</li> -->
          <li>Effects are applied to the audio in top-to-bottom order.</li>
          <li>Click the value next to a slider to add your own specific value that's outside of the slider's range.</li>
          <li>You are free to use the generated audio for any purpose at all, including commercially. A link or a mention would be nice (üòä), but is not necessary.</li>
          <li>Got an idea or feedback? Share it with me <a href="https://s.surveyplanet.com/6xl3v8jy">here</a>.</li>
          <li>Please understand that this is a hobby project, so feature requests may not be implemented in a timely manner.</li>
        </ul>
      </div>
      
    </main>
      
    <br><br><br>
    <p style="margin: 0; text-align: center; font-size: 90%; opacity: 0.5;">ADVERTISEMENT:</p>
    <div style="text-align:center;">
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
      <!-- voicechanger.io/voicemaker -->
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-3263838347296949"
           data-ad-slot="7680499533"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>  
    </div>

    <br><br><br>


    <script>


      const effectSpecs = [
        {
          name: "pitchShift",
          title: "Pitch Shift",
          description: "This effect alters the pitch of the audio. If you set a positive value then the voice will be high-pitched (like a small child or a chipmunk), and if you set a negative value then the voice will be deep (like a big troll or a demon). A value of zero is neutral (no effect). You can of couse apply this effect multiple times in a row to make it deeper/higher than the min/max values allowed by the input sliders.",
          params: [
            {name:"shift", title:"Shift", type:"range", min:-2, max:4, step:0.01, value:1},
          ]
        },
        {
          name: "phaser",
          title: "Phaser",
          description: "A <a href='https://en.wikipedia.org/wiki/Phaser_(effect)' target='_blank'>phaser</a> creates a 'wobbly' synthetic sound using a low-frequency oscillator and some fancy maths. Have a play around witht he parameters below.",
          params: [
            {name:"rate", title:"Rate", type:"range", min:0.01, max:20, step:0.01, value:8},
            {name:"depth", title:"Depth", type:"range", min:0, max:1, step:0.01, value:0.3},
            {name:"feedback", title:"Feedback", type:"range", min:0, max:3, step:0.01, value:0.9},
            {name:"stereoPhase", title:"Stereo Phase", type:"range", min:0, max:180, step:0.5, value:100},
            {name:"baseModFreq", title:"Base Mod Freq.", type:"range", min:500, max:1500, step:1, value:500},
          ]
        },
        {
          name: "speed",
          title: "Speed (Faster / Slower)",
          description: "As you might imagine, this module speeds up or slows down the audio, depending on how you adjust the parameter. A value of 1 has no effect (same as input audio). If you need it to be even faster than the allowed value, you can apply this effect multiple times and max-out the speed on each, as necessary. Want to <u>maintain the pitch of the voice</u>? Just add a Pitch Shifter effect after it and adjust the settings as necessary.",
          params: [
            {name:"multiplier", title:"Multiplier", type:"range", min:0, max:10, step:0.01, value:2},
          ]
        },
        {
          name: "autowah",
          title: "Autowah",
          description: "Applies the famous autowah effect to the audio. Normal 'wah' effects are controlled by a pedal that the musician uses. Instead of this, autowah is controlled by the volume of the input signal. Read more about <a href='https://en.wikipedia.org/wiki/Auto-wah' target='_blank'>the effect</a> on wikipedia.",
          params: [
            {name:"followerFreq", title:"Follower Freq.", type:"range", min:0, max:100, step:0.1, value:10},
            {name:"wetGain", title:"Wet Gain", type:"range", min:0, max:2, step:0.1, value:1},
            {name:"comprThres", title:"Compressor Thres.", type:"range", min:-100, max:100, step:0.5, value:-20},
            {name:"comprRatio", title:"Compressor Ratio", type:"range", min:0, max:70, step:0.1, value:16},
            {name:"depthGain", title:"Depth Gain", type:"range", min:0, max:30000, step:1, value:11585},
            {name:"filterQ", title:"Filter Q", type:"range", min:0, max:50, step:1, value:15},
            {name:"filterFreq", title:"Filter Freq.", type:"range", min:0, max:150, step:1, value:50},
          ]
        },
        {
          name: "synth",
          title: "Synth / Vocoder",
          description: "A <a href='https://en.wikipedia.org/wiki/Vocoder' target='_blank'>vocoder</a> simplifies an input sound signal by discarding many of the natural frequencies that exist within human speech (or any audio, really), so that the amount of bandwidth required to transmit it is much smaller. They were originally used in the 1930s for telecommunication. Have a play with the parameters to get some fun effects.",
          params: [
            {name:"modulatorGain", title:"Modulator Gain", type:"range", min:0, max:10, step:0.1, value:1},
            {name:"noise", title:"Noise", type:"range", min:0, max:1, step:0.01, value:0.2},
            {name:"sample", title:"Sample", type:"range", min:0, max:1, step:0.01, value:0},
            {name:"synth", title:"Synth", type:"range", min:0, max:1, step:0.01, value:1},
            {name:"synthDetune", title:"Synth Detune", type:"range", min:-5000, max:5000, step:1, value:0},
          ]
        },
        {
          name: "deepScary",
          title: "Deep Scary",
          description: "This makes your voice sound like some sort of powerful dark monster. Move the slider to control how strong the effect is. If you have a high voice, then add a Pitch Shifter effect before this one and lower the pitch a bit - that'll make it sound more evil.",
          params: [
            {name:"magnitude", title:"Amount", type:"range", min:0, max:1, step:0.01, value:1},
          ]
        },
        {
          name: "ringModulator",
          title: "Ring Modulator (Dalek Robot)",
          description: "This makes your voice sound like the Dalek robots from Dr Who. <span style='font-size: 90%;'>EXTERMINATE!</span>",
          params: [
            {name:"magnitude", title:"Magnitude", type:"range", min:0, max:1, step:0.01, value:1},
            {name:"frequency", title:"Frequency", type:"range", min:0.1, max:200, step:0.01, value:30},
          ]
        },
        {
          name: "giantRobot",
          title: "Giant Robot",
          description: "This makes your voice sound like a giant robot. It works by mixing together a bunch of different pitch shifts.",
          params: [
            {name:"magnitude", title:"Magnitude", type:"range", min:0, max:1, step:0.01, value:1},
          ]
        },
        {
          name: "tinyRobot",
          title: "Tiny Robot",
          description: "This makes your voice sound like a very tiny robot. Like a robotic mosquito that can talk. Play around with the 'Chunk Seconds' value for some other interesting effects.",
          params: [
            {name:"magnitude", title:"Magnitude", type:"range", min:0, max:1, step:0.01, value:1},
            {name:"chunkSeconds", title:"Chunk Seconds", type:"range", min:0.001, max:1, step:0.001, value:0.05},
            {name:"variation", title:"Variation", type:"select", value:1, options:[{value:1, label:"Type #1"}, {value:2, label:"Type #2"}]},
          ]
        },
        {
          name: "alienRobot",
          title: "Alien Robot",
          description: "This sounds like a sort of robotic alien insect thing - or some sort of alien robot, anyway. You can play around with the parameters to create some other strange effects too. Make sure to try <u>lowering the frequency</u> for some fun effects! Note that the \"magnitude\" parameter controls the <i>overall</i> amount that this effect is applied.",
          params: [
            {name:"magnitude", title:"Magnitude", type:"range", min:0, max:1, step:0.01, value:1},
            {name:"oscType", title:"Oscillator Type", type:"select", value:"sine", options:[{value:"sine", label:"sine wave"}, {value:"square", label:"square wave"}, {value:"sawtooth", label:"sawtooth wave"}, {value:"triangle", label:"triangle wave"}]},
            {name:"frequency", title:"Frequency", type:"range", min:0.01, max:200, step:0.01, value:40},
            {name:"oscGain", title:"Oscillator Gain", type:"range", min:0.001, max:0.08, step:0.001, value:0.015},
            {name:"delayTime", title:"Delay Time", type:"range", min:0.01, max:1, step:0.01, value:0.05},
          ]
        },
        {
          name: "beepBoopRobot",
          title: "Beep Boop Robot",
          description: "This is your classic 'beep boop' robot voice with R2D2-style sounds in the background. You can adjust the beep boop length and modify the loudness a bit.",
          params: [
            {name:"magnitude", title:"Magnitude", type:"range", min:0.001, max:1, step:0.001, value:1},
            {name:"beepLength", title:"Beep Length", type:"range", min:1, max:50000, step:1, value:1700},
            {name:"beepGain", title:"Beep Mod", type:"range", min:0.0, max:0.35, step:0.005, value:0.05},
          ]
        },
        {
          name: "robotic",
          title: "Frog Robot",
          description: "Another robot voice that's using a simple oscillator of your choosing, and some frequency spectrum adjustment. You should be able to create a large range of different robot voices by tweaking these parameters.",
          params: [
            {name:"magnitude", title:"Magnitude", type:"range", min:0.001, max:1, step:0.001, value:1},
            {name:"osc1Freq", title:"Oscillator Frequency", type:"range", min:1, max:1500, step:1, value:230},
            {name:"osc1Gain", title:"Oscillator Gain", type:"range", min:0, max:0.02, step:0.0001, value:0.002},
            {name:"osc1Type", title:"Oscillator Type", type:"select", value:"triangle", options:[{value:"sine", label:"sine wave"}, {value:"square", label:"square wave"}, {value:"sawtooth", label:"sawtooth wave"}, {value:"triangle", label:"triangle wave"}]},
            {name:"highpassFrequency", title:"High-Pass Frequency", type:"range", min:0, max:20000, step:1, value:695},
          ]
        },
        {
          name: "megaphone",
          title: "Megaphone",
          description: "Adds a bit of distortion so that it sounds like a megaphone. If lots more distortion, apply this effect several times by adding it again using the effects list. You might also like to try combining it with an echo effect.",
          params: [
            {name:"distortion", title:"Distortion", type:"range", min:0, max:1000, step:1, value:50},
          ]
        },
        {
          name: "distopianPA",
          title: "Distopian Public Announcement",
          description: "Combines distortion with a significant echo effect to create a the sort of sound that you might hear in a big old train station. Sounds sort of distopian, but could be used for other purposes.",
          params: [
            {name:"distortion", title:"Distortion", type:"range", min:0, max:1000, step:1, value:100},
            {name:"lowPassFreq", title:"Low Pass Freq", type:"range", min:0, max:20000, step:1, value:3000},
            {name:"wetGain", title:"Overall", type:"range", min:0, max:2, step:0.01, value:1},
          ]
        },
        {
          name: "reverseReverb",
          title: "Ghost (Reverse Reverb)",
          description: "An effect that is commonly used to make a voice sound supernatural, or ghost-like. It essentially applies a 'reversed' echo effect.",
          params: [
            {name:"dryGain", title:"Adjust", type:"range", min:0, max:1, step:0.01, value:0.5},
          ]
        },
        {
          name: "churchEcho",
          title: "Church Echo",
          description: "An echo effect using an 'impulse response' that was recorded in a large church.",
          params: [
            {name:"echoMag", title:"Echo Gain", type:"range", min:0, max:2, step:0.01, value:1},
            {name:"inputMag", title:"Input Gain", type:"range", min:0, max:2, step:0.01, value:0},
          ]
        },
        {
          name: "telephone",
          title: "Telephone",
          description: "Telcos often filter out high and low frequencies that are outside normal human voice ranges to save on data transfer costs, and that's what gives telephones (at least, old ones) their distinctive sound. This voice effect trys to mimic that frequency filtering to produce a voice that sounds like it's coming through a telephone.",
          params: [
            {name:"magnitude", title:"Magnitude", type:"range", min:0, max:1, step:0.01, value:1},
            {name:"lowPassFreq", title:"Low Pass", type:"range", min:1, max:20000, step:1, value:2000},
            {name:"highPassFreq", title:"High Pass", type:"range", min:1, max:20000, step:1, value:500},
          ]
        },
        {
          name: "wobble",
          title: "Wobble (Pitch Distortion)",
          description: "Makes your voice wobble! Adjust the paramaters to create some very funky voice effects.",
          params: [
            {name:"freq", title:"Frequency", type:"range", min:0, max:20, step:0.1, value:1},
            {name:"amplitude", title:"Amplitude", type:"range", min:0, max:1, step:0.01, value:0.05},
            {name:"delay", title:"Delay", type:"range", min:0, max:2, step:0.01, value:0.05},
            {name:"magnitude", title:"Effect", type:"range", min:0, max:1, step:0.01, value:1},
          ]
        },
        {
          name: "anonymous",
          title: "Anonymous (Distorter)",
          description: "Makes your voice sound like a l33t hacker by applying a deepening effect (using a sawtooth oscillator) along with some distortion and white noise. Please note that this won't actually make your voice anonymous. If you want real anonymity, you should use a text-to-speech generator.",
          params: [
            {name:"distortion", title:"Distortion", type:"range", min:0, max:200, step:1, value:50},
            {name:"noiseMod", title:"Noise Mod", type:"range", min:1, max:10, step:1, value:9},
            {name:"oscFreq", title:"Sawtooth", type:"range", min:1, max:100, step:1, value:50},
          ]
        },
        {
          name: "reverseTime",
          title: "Reverse Time",
          description: "Reverses the audio clip - i.e. plays the sound backwards. Can be used to produce audio that sounds like it is being spoken in another language, but which actually has a hidden message. If you apply this effect twice it will, predictably, produce the same audio that you input.",
          params: []
        },
        {
          name: "oldRadio",
          title: "Old Radio",
          description: "Applies a bunch of distortion and a bit of oscillation stuff to create a voice effect which sounds a bit like an old radio.",
          params: [
            {name:"distortion", title:"Distortion", type:"range", min:0, max:200, step:1, value:50},
            {name:"magnitude", title:"Effect", type:"range", min:0, max:1, step:0.01, value:1},
          ]
        },
        {
          name: "cymbalConvolver",
          title: "Cymbal Convolver (Metalic Effect)",
          description: "Applies a reverb effect using a drum cymbal's impulse response.",
          params: [
            {name:"echoMag", title:"Echo Gain", type:"range", min:0, max:1, step:0.01, value:1},
            {name:"inputMag", title:"Input Gain", type:"range", min:0, max:1, step:0.01, value:0.3},
          ]
        },
        {
          name: "vibrato",
          title: "Vibrato (Smooth Wobble)",
          description: "Applies a smooth wobble effect to your voice, so if you sing a flat note it'll sound like you're singing with a vibrato. Try saying 'laaaaaaaaaaaa' and then applying this effect to it.",
          params: [
            {name:"freq", title:"Frequency", type:"range", min:0, max:20, step:0.1, value:4.5},
          ]
        },
        {
          name: "longEcho",
          title: "Long Echo (Cavern)",
          description: "Applies a convolution to your input voice to create a long echoing voice effect. It's as if you are talking in a large underground cavern - it actually uses an impulse response from a cave.",
          params: [
            {name:"wetGain", title:"Echo", type:"range", min:0, max:2, step:0.1, value:1},
            {name:"dryGain", title:"Input", type:"range", min:0, max:2, step:0.1, value:1},
          ]
        },
        {
          name: "generalRobot",
          title: "Robot Maker",
          description: "This module can be used to create a huge variety of different robot voices. Try playing around with the different values. To disable an oscillator, set its frequency to zero.",
          params: [
            {name:"osc1Freq", title:"Oscillator 1 Freq.", type:"range", min:0, max:1500, step:1, value:50},
            {name:"osc2Freq", title:"Oscillator 2 Freq.", type:"range", min:0, max:1500, step:1, value:340},
            {name:"osc3Freq", title:"Oscillator 3 Freq.", type:"range", min:0, max:1500, step:1, value:0},
            {name:"osc1Type", title:"Oscillator 1 Type", type:"select", value:"sawtooth", options:[{value:"sine", label:"sine wave"}, {value:"square", label:"square wave"}, {value:"sawtooth", label:"sawtooth wave"}, {value:"triangle", label:"triangle wave"}]},
            {name:"osc2Type", title:"Oscillator 2 Type", type:"select", value:"sawtooth", options:[{value:"sine", label:"sine wave"}, {value:"square", label:"square wave"}, {value:"sawtooth", label:"sawtooth wave"}, {value:"triangle", label:"triangle wave"}]},
            {name:"osc3Type", title:"Oscillator 3 Type", type:"select", value:"sawtooth", options:[{value:"sine", label:"sine wave"}, {value:"square", label:"square wave"}, {value:"sawtooth", label:"sawtooth wave"}, {value:"triangle", label:"triangle wave"}]},
            {name:"oscGain", title:"Oscillator Gain", type:"range", min:0, max:0.02, step:0.0001, value:0.004},
            {name:"magnitude", title:"Overall", type:"range", min:0.001, max:1, step:0.001, value:0.9},
          ]
        },
        {
          name: "veryDistortedRadio",
          title: "Very Distorted Radio",
          description: "This effect tries to emulate audio that's coming across a very noisy channel - perhaps an old military radio that's almost out of range, or a CB hand-held radio that's in an area with high interference. Try playing around with the values to come up with other effects or make it more of less severe.",
          params: [
            {name:"samplePeriod", title:"Sample Period", type:"range", min:1, max:100, step:1, value:7},
            {name:"waveDistortion", title:"Wave Distortion", type:"range", min:0, max:50, step:0.5, value:5},
            {name:"squeakMult", title:"Squeak", type:"range", min:0, max:10, step:0.1, value:1},
            {name:"masterGain", title:"Master Gain", type:"range", min:0, max:3, step:0.1, value:0.3},
          ]
        },
        {
          name: "shuffleChunks",
          title: "Shuffle Chunks",
          description: "This effect cuts up the audio into chunks and then shuffles them about, often producing a very confusing audio clip as a result. You can adjust the chunk size below. Note that if you use this effect on short audio clips, then you should use a short chunk time, otherwise it may end up being randomly shuffled into the same order as the input.",
          params: [
            {name:"secondsPerChunk", title:"Seconds Per Chunk", type:"range", min:0.01, max:10, step:0.01, value:1},
          ]
        },
        {
          name: "mirroredChunks",
          title: "Messed Up Chunks",
          description: "This effect cuts up the audio into chunks and then shuffles them about, and then does some weird mirroring stuff. You can adjust the chunk size below. Note that if you use this effect on short audio clips, then you should use a short chunk time.",
          params: [
            {name:"chunkSeconds", title:"Seconds Per Chunk", type:"range", min:0.01, max:10, step:0.01, value:1},
          ]
        },
        {
          name: "flipDistortion",
          title: "Wave Flip Distortion",
          description: "This is a type of distortion effect which works by randomly flipping samples from the audio wave from negative, up to positive at a set interval. Try adjusting the values to see what you come up with.",
          params: [
            {name:"flipGap", title:"Flip Gap", type:"range", min:1, max:10000, step:1, value:100},
            {name:"flipProb", title:"Flip Chance", type:"range", min:0, max:1, step:0.01, value:0.2},
            {name:"lowPass", title:"Low Pass", type:"range", min:0, max:20000, step:1, value:2000},
          ]
        },
        {
          name: "satan",
          title: "Demon",
          description: "This is a type of distortion effect which works by randomly flipping samples from the audio wave from negative, up to positive at a set interval. Try adjusting the values to see what you come up with.",
          params: [
            {name:"chunkSeconds", title:"Chunk Seconds", type:"range", min:0.001, max:3, step:0.001, value:0.01},
            {name:"playMod", title:"Mod", type:"range", min:1, max:10, step:1, value:2},
            {name:"lowPass", title:"Low Pass", type:"range", min:0, max:20000, step:1, value:3000},
          ]
        },
        {
          name: "signalInterferance",
          title: "Signal Interferance",
          description: "This effect clips out chunks of the audio as if they've been removed by interference. Try adjusting the parameter to get some different effects.",
          params: [
            {name:"chunkLenClip", title:"Clip Length", type:"range", min:1, max:100, step:1, value:20},
          ]
        },
        {
          name: "giantMonster",
          title: "Giant Monster",
          description: "This module can be used to create a large variety of different voices, but the default one sounds a bit like a giant monster, so that's what I've called it. Have fun playing around with the parameters, and remember to try mixing it up with pitch shifts and other effects.",
          params: [
            {name:"osc1Freq", title:"Oscillator 1 Freq.", type:"range", min:-100, max:100, step:1, value:-10},
            {name:"osc2Freq", title:"Oscillator 2 Freq.", type:"range", min:-100, max:200, step:1, value:50},
            {name:"osc3Freq", title:"Oscillator 3 Freq.", type:"range", min:-100, max:200, step:1, value:30},
            {name:"osc1Type", title:"Oscillator 1 Type", type:"select", value:"sawtooth", options:[{value:"sine", label:"sine wave"}, {value:"square", label:"square wave"}, {value:"sawtooth", label:"sawtooth wave"}, {value:"triangle", label:"triangle wave"}]},
            {name:"osc2Type", title:"Oscillator 2 Type", type:"select", value:"sawtooth", options:[{value:"sine", label:"sine wave"}, {value:"square", label:"square wave"}, {value:"sawtooth", label:"sawtooth wave"}, {value:"triangle", label:"triangle wave"}]},
            {name:"osc3Type", title:"Oscillator 3 Type", type:"select", value:"sawtooth", options:[{value:"sine", label:"sine wave"}, {value:"square", label:"square wave"}, {value:"sawtooth", label:"sawtooth wave"}, {value:"triangle", label:"triangle wave"}]},
            {name:"gain1", title:"Gain 1", type:"range", min:0, max:0.02, step:0.0001, value:0.007},
            {name:"gain2", title:"Gain 2", type:"range", min:0, max:0.02, step:0.0001, value:0.007},
            {name:"gain3", title:"Overall Gain", type:"range", min:0, max:2, step:0.01, value:0.9},
            {name:"delay1", title:"Delay 1", type:"range", min:0, max:0.2, step:0.001, value:0.01},
            {name:"delay2", title:"Delay 2", type:"range", min:0, max:0.2, step:0.001, value:0.01},
            {name:"lowPass", title:"Low Pass", type:"range", min:0, max:20000, step:1, value:2000},
          ]
        },
        {
          name: "astronaut",
          title: "Astronaut",
          description: "This module tries to emulate the noise/distortion that you hear in old audio clips of astronauts talking in space. It's similar to the telephone effect, but with some more distortion.",
          params: [
            {name:"distortion", title:"Distortion", type:"range", min:0, max:200, step:1, value:50},
            {name:"lowPassFreq", title:"Low Pass", type:"range", min:1, max:20000, step:1, value:2000},
            {name:"highPassFreq", title:"High Pass", type:"range", min:1, max:20000, step:1, value:500},
          ]
        },
        {
          name: "evilRobot",
          title: "Evil Robot",
          description: "This voice effect combines a synth effect with a pitch offset to create a sort of evil-sounding robot. Or maybe it's just 'raspy', not evil.",
          params: [
            {name:"mod", title:"Mod", type:"range", min:0, max:10, step:0.1, value:0.4},
            {name:"pitch", title:"Pitch", type:"range", min:-2, max:2, step:0.01, value:-0.4},
          ]
        },
        {
          name: "biquadFilter",
          title: "Biquad Frequency Filter",
          description: "This applies a standard frequency filter of your choosing. Note that the shelf filters don't use the Q parameter. Check out <a href='https://developer.mozilla.org/en-US/docs/Web/API/BiquadFilterNode' target='_blank'>this page</a> for details on the settings.",
          params: [
            {name:"type", title:"Type", type:"select", value:"lowpass", options:[{value:"lowpass", label:"lowpass"}, {value:"highpass", label:"highpass"}, {value:"bandpass", label:"bandpass"}, {value:"lowshelf", label:"lowshelf"}, {value:"highshelf", label:"highshelf"}, {value:"peaking", label:"peaking"}, {value:"notch", label:"notch"}, {value:"allpass", label:"allpass"}]},
            {name:"freq", title:"Frequency", type:"range", min:0, max:20000, step:1, value:2000},
            {name:"Q", title:"Q", type:"range", min:0.001, max:1000, step:0.001, value:1},
            {name:"detune", title:"Detune", type:"range", min:-1000, max:1000, step:1, value:0},
            {name:"gain", title:"Gain", type:"range", min:-10, max:10, step:0.1, value:0},
          ]
        },
        {
          name: "gain",
          title: "Gain (Louder / Quieter)",
          description: "This simply allows you to adjust the volume of the output audio. It's useful if you've added some effects that have made your clip to quiet or too loud. If you put this between two effects, then it can help you prevent 'clipping' where the volume goes too high and the audio starts 'clicking'. Check out the 'Compressor' effect to more 'intelligently' get rid of high peaks.",
          params: [
            {name:"gain", title:"Gain", type:"range", min:0, max:3, step:0.1, value:1},
          ]
        },
        {
          name: "overdrive",
          title: "Overdrive Distortion",
          description: "Applies the well-known 'overdrive' effect (a type of distortion) to the input audio.",
          params: [
            {name:"preBand", title:"Pre Band", type:"range", min:0, max:1, step:0.01, value:0.5},
            {name:"color", title:"Color", type:"range", min:0, max:22050, step:1, value:800},
            {name:"drive", title:"Drive", type:"range", min:0, max:1, step:0.01, value:0.5},
            {name:"postCut", title:"Post Cut", type:"range", min:0, max:22050, step:1, value:3000},
          ]
        },
        {
          name: "overdrive2",
          title: "Overdrive Distortion 2",
          description: "Applies the well-known 'overdrive' effect (a type of distortion) to the input audio.",
          params: [
            {name:"outputGain", title:"Output Gain", type:"range", min:0, max:2, step:0.01, value:0.5},
            {name:"drive", title:"Drive", type:"range", min:0, max:1, step:0.01, value:0.7},
            {name:"curveAmount", title:"Curve Amount", type:"range", min:0, max:1, step:0.01, value:1},
            {name:"algorithmIndex", title:"Algorithm Type", type:"range", min:0, max:5, step:1, value:0},
          ]
        },
        {
          name: "chorus",
          title: "Chorus",
          description: "Applies a chorus effect. This processor achieves the effect by taking an audio signal and mixing it with one or more delayed, pitch-modulated copies of itself. Read more about it <a href='https://en.wikipedia.org/wiki/Chorus_effect' target='_blank'>here</a>.",
          params: [
            {name:"rate", title:"Rate", type:"range", min:0.01, max:20, step:0.01, value:1.5},
            {name:"feedback", title:"Feedback", type:"range", min:0, max:1, step:0.01, value:0.2},
            {name:"delay", title:"Delay", type:"range", min:0, max:1, step:0.0001, value:0.0045},
          ]
        },
        {
          name: "delay",
          title: "Delay (Echo)",
          description: "Applies a 'delay' effect where many copies of the input audio are overlayed on one another with a set delay.",
          params: [
            {name:"feedback", title:"Feedback", type:"range", min:0, max:2, step:0.01, value:0.45},
            {name:"delayTime", title:"Delay (ms)", type:"range", min:0, max:10000, step:1, value:150},
            {name:"wetLevel", title:"Wet Level", type:"range", min:0, max:2, step:0.001, value:0.25},
            {name:"dryLevel", title:"Dry Level", type:"range", min:0, max:2, step:0.001, value:1},
            {name:"cutoff", title:"Cut Off", type:"range", min:20, max:22050, step:1, value:2000},
          ]
        },
        {
          name: "compressor",
          title: "Compressor",
          description: "A dynamics compression module. It lowers the volume of the loudest parts of the signal in order to help prevent clipping and distortion that can occur when multiple sounds are played and multiplexed together at once.",
          params: [
            {name:"threshold", title:"Threshold", type:"range", min:-100, max:0, step:1, value:-1},
            {name:"makeupGain", title:"Makeup Gain", type:"range", min:0, max:100, step:1, value:1},
            {name:"attack", title:"Attack", type:"range", min:0, max:1000, step:1, value:1},
            {name:"release", title:"Release", type:"range", min:0, max:3000, step:1, value:0},
            {name:"ratio", title:"Ratio", type:"range", min:0, max:20, step:0.1, value:4},
            {name:"knee", title:"Knee", type:"range", min:0, max:40, step:0.1, value:5},
            {name:"automakeup", title:"Auto Makeup", type:"select", value:1, options:[{value:1,label:"Yes"}, {value:0,label:"No"}]},
          ]
        },
        {
          name: "tremolo",
          title: "Tremolo",
          description: "A <a href='https://en.wikipedia.org/wiki/Tremolo_(electronic_effect)' target='_blank'>tremolo effect</a> varies the aplitude of the sound according to some rate/frequency. This is not to be confused with vibrato which varies the <i>frequency</i> of the sound over time. To hear this effect properly, try saying 'laaaaaaaaa' as an extended note for a few seconds into the microphone.",
          params: [
            {name:"intensity", title:"Intensity", type:"range", min:0, max:1, step:0.01, value:0.3},
            {name:"rate", title:"Rate", type:"range", min:0.001, max:20, step:0.001, value:4},
            {name:"stereoPhase", title:"Stereo Phase", type:"range", min:0, max:180, step:0.1, value:0},
          ]
        },
        {
          name: "wahWah",
          title: "WahWah",
          description: "A wahwah effect with all the options.",
          params: [
            {name:"baseFreq", title:"Base Freq.", type:"range", min:0, max:1, step:0.01, value:0.5},
            {name:"excOctaves", title:"Excursion Octaves", type:"range", min:1, max:6, step:0.1, value:2},
            {name:"sweep", title:"Sweep", type:"range", min:0, max:1, step:0.01, value:0.2},
            {name:"resonance", title:"Resonance", type:"range", min:1, max:100, step:0.5, value:10},
            {name:"sensitivity", title:"Sensitivity", type:"range", min:-1, max:1, step:0.01, value:0.5},
            {name:"automode", title:"Auto", type:"select", value:1, options:[{value:1,label:"Yes"}, {value:0,label:"No"}]},

          ]
        },
        {
          name: "bitcrusher",
          title: "Bitcrusher (lo-fi)",
          description: "Classic <a href='https://en.wikipedia.org/wiki/Bitcrusher' target='_blank'>bitcrusher</a> audio effect.",
          params: [
            {name:"bits", title:"Bits", type:"range", min:1, max:16, step:1, value:4},
            {name:"normfreq", title:"Norm Freq.", type:"range", min:0, max:1, step:0.01, value:0.1},
            {name:"bufferSize", title:"Buffer Size", type:"select", value:4096, options:[{value:256,label:"256"},{value:512,label:"512"},{value:1024,label:"1024"},{value:2048,label:"2048"},{value:4096,label:"4096"},{value:8192,label:"8192"},{value:16384,label:"16384"}]},
          ]
        },
        {
          name: "moogFilter",
          title: "Moog Filter",
          description: "Classic <a href='https://en.wikipedia.org/wiki/Moog_synthesizer' target='_blank'>moog filter</a> audio effect.",
          params: [
            {name:"cutoff", title:"Cutoff", type:"range", min:0, max:1, step:0.001, value:0.065},
            {name:"resonance", title:"Resonance", type:"range", min:0, max:4, step:0.01, value:3.5},
            {name:"bufferSize", title:"Buffer Size", type:"select", value:4096, options:[{value:256,label:"256"},{value:512,label:"512"},{value:1024,label:"1024"},{value:2048,label:"2048"},{value:4096,label:"4096"},{value:8192,label:"8192"},{value:16384,label:"16384"}]},
          ]
        },
        {
          name: "vowelFilter",
          title: "Vowel Filter",
          description: "Uses a bunch of biquad filters to filter out out frequencies other than those of a certain vowel. This isn't all too useful unless your input sound is very 'constant'.",
          params: [
            {name:"vowelValue", title:"Vowel", type:"range", min:0, max:10.99, step:0.0275, value:0, valueToHTML:(v) => vowelSpecs[Math.round(v)].ex},
          ]
        },
      ];
      const effectSpecsMap = effectSpecs.reduce((a,v) => (a[v.name]=v, a), {});

      effectsAdderSelect.innerHTML = `<option value="">Click to add an effect...</option>`+effectSpecs.map(e => `<option value="${e.name}">${e.title}</option>`).join("")+`<option value="RANDOM">Make a Random Voice</option>`;

      let defaultUrlData = `{"effects":[{"name":"pitchShift", "params":{"shift":2}}], "version":1}`;
      if(!window.location.hash.slice(3).trim()) window.location.hash = "#!/"+defaultUrlData;
      let initialUrlData = JSON.parse(decodeURIComponent(window.location.hash.slice(3)));
      window.effects = initialUrlData.effects;

      window.addEventListener('DOMContentLoaded', function() {
        console.log("inital effects:", window.effects);
        for(let {name, params} of window.effects) {
          //let paramsMap = params.reduce((a,v) => (a[v.name]=v.value, a), {});
          addEffect(name, params);
        }
      });

      async function makeRandomVoice() {
        let effects = shuffleArray(effectSpecs.slice(0)).slice(0, 2 + Math.round(Math.random())).map(e => JSON.parse(JSON.stringify(e))).map(e => ({name:e.name, params:e.params.reduce((a,v) => (a[v.name]=v.value,a), {})}));
        [...effectsList.querySelectorAll(".effect")].forEach(el => el.querySelector(".remove").click())
        await new Promise(r => setTimeout(r, 100));
        for(let {name, params} of effects) {
          addEffect(name, params);
        }
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      function addEffect(name, params, placement="end") {
        params = JSON.parse(JSON.stringify(params));

        if(!params) params = effectSpecsMap[name].params.reduce((a,v) => (a[v.name]=v.value, a), {});

        // make sure all params are included. add defaults for ones that are not (this allows me to add new parameters without things breaking)
        let gotAlready = Object.keys(params);
        let dontGot = effectSpecsMap[name].params.map(p => p.name).filter(n => !gotAlready.includes(n));
        if(dontGot.length > 0) {
          console.log("adding defaults for:", dontGot, `(${name} effect)`);
          let defaults = effectSpecsMap[name].params.reduce((a,v) => (a[v.name]=v.value, a), {});
          for(let name of dontGot) {
            params[name] = defaults[name];
          }
        }

        let html = generateEffectHtml(effectSpecsMap[name], params);
        effectsList.insertAdjacentHTML(placement == "start" ? "afterbegin" : "beforeend", html);

        updateEffectsData();
        // if(typeof globalAudioBuffer !== 'undefined' && globalAudioBuffer) {
        //   loadOutputAudio();
        // }
      }

      function updateEffectsData() {
        window.effects = [...effectsList.querySelectorAll(".effect")].map(el => ({name:el.dataset.effect, params:JSON.parse(decodeURIComponent(el.dataset.params))}));
        if(window.effects.length === 0) window.location.hash = "";
        else window.location.hash = "#!/"+JSON.stringify({effects:window.effects, version:1});

        urlInputEl.value = window.location.href;

        if(window.globalAudioBuffer) {
          regenerateAudioButton.classList.add("blink");
          regenerateAudioButton.style.fontWeight = "bold";
        }
      }

      function generateParamHtml(p, value) {
        value = value !== undefined ? value : p.value;
        let onChangeEvent = "this.closest('.effect').dataset.params = encodeURIComponent(JSON.stringify([...this.closest('.effect').querySelectorAll('.param input, .param select')].reduce((a,el) => (a[el.dataset.name]=Number(el.value)+'' === el.value ? Number(el.value) : el.value, a), {}))); updateEffectsData();";
        let inputHtml;
        if(p.type === "range") {
          inputHtml = `<input data-name="${p.name}" onchange="${onChangeEvent}" type="range" value="${value}" step="${p.step}" min="${p.min}" max="${p.max}" oninput="this.nextElementSibling.firstChild.innerHTML=${p.valueToHTML ? "("+p.valueToHTML.toString()+")(this.value)" : "this.value"};"/><div class="range-param-display" onclick="let n = prompt('Enter a value for this parameter:'); if(n !== null && n.trim() !== '' && !isNaN(Number(n))) { this.previousElementSibling.value=Number(n); this.firstChild.innerText=Number(n); this.previousElementSibling.onchange(); }" style="cursor:pointer; width:min-content; font-family:monospace; text-align: center; padding: 0.3rem;"><span>${value}</span></div>`;
        } else if(p.type === "input") {
          inputHtml = `<input data-name="${p.name}" onchange="${onChangeEvent}" type="text" value="${value}"/>`;
        } else if(p.type === "select") {
          inputHtml = `<select data-name="${p.name}" onchange="${onChangeEvent}">
            ${p.options.map(o => `<option value="${o.value}" ${value === o.value ? "selected" : ""}>${o.label}</option>`).join("")}
          </select>`;
        }
        return `<div class="param">
          <div class="name">${p.title}: &nbsp;</div>
          <div class="input-wrapper">${inputHtml}</div>
        </div>`;
      }
      function generateEffectHtml(e, params={}) {
        let paramHtml = e.params.map((p,i) => generateParamHtml(p, params[p.name])).join("");
        return `<div class="effect" data-effect="${e.name}" data-params="${encodeURIComponent(JSON.stringify(params))}">
          <div class="header">
            <div class="title">${e.title}</div>
            <div class="icon remove" style="cursor:pointer; width: 1.7rem; text-align: center;" onclick="this.closest('.effect').remove(); updateEffectsData();" title="delete this effect">‚®Ø</div>
            <div class="handle icon" style="margin-left:0.5rem; width: 1.7rem; text-align: center;" title="drag to re-order" onclick="let menu = this.parentNode.querySelector('.title-menu'); menu.classList.add('visible'); setTimeout(() => visibleTransformTitleMenu = menu, 100);">‚Üï</div>
            <div class="title-menu">
              <div class="menu-item" onclick="moveEffectEl(this.closest('.effect'), 'up')">move up</div>
              <div class="menu-item" onclick="moveEffectEl(this.closest('.effect'), 'down')">move down</div>
            </div>
          </div>
          <div class="description">${e.description}</div>
          <div class="params">
            ${paramHtml}
          </div>
        </div>`;
      }

      function moveEffectEl(el, direction) {
        let changed = false;
        if(direction === "down" && el.nextElementSibling) {
          el.nextElementSibling.after(el);
          changed = true;
        } else if(direction === "up" && el.previousElementSibling) {
          el.parentNode.insertBefore(el, el.previousElementSibling);
          changed = true;
        }
        if(changed && window.globalAudioBuffer) {
          regenerateAudioButton.classList.add("blink");
          regenerateAudioButton.style.fontWeight = "bold";
        }
      }


      let alreadyLoadingOutputAudio = false;
      async function loadOutputAudio() {
        if(typeof globalAudioBuffer === 'undefined' || !globalAudioBuffer) {
          alert("Have you chosen an input audio file, or recorded an audio clip using your microphone? Please do that first üëç");
          return;
        }
        if(alreadyLoadingOutputAudio) {
          return;
        }
        alreadyLoadingOutputAudio = true;
        let $ = document.querySelector.bind(document);

        regenerateAudioButton.classList.remove("blink");
        regenerateAudioButton.style.fontWeight = "unset";

        $(".output-voice-ctn").style.opacity = 1;
        $("#voice-output-loader").style.display = "";
        $("#voice-output-area").style.display = "none";

        let outputAudioBuffer = globalAudioBuffer;
        let i = 0;
        for(let effect of window.effects) {
          effectLoadProgressMessage.innerHTML = `applying effect ${i+1}/${window.effects.length}...`;
          // let params = effect.params.reduce((a, value, i) => (a[effectSpecsMap[effect.name].params[i].name]=value, a), {});
          // let paramsMap = effect.params.reduce((a,v) => (a[v.name]=v.value, a), {});
          let params = JSON.parse(JSON.stringify(effect.params));
          outputAudioBuffer = await window[effect.name+"Transformer"](outputAudioBuffer, params);
          i++;
        }
        effectLoadProgressMessage.innerHTML = `converting buffer to a .wav file...`;
        let outputWavBlob = await audioBufferToWaveBlob(outputAudioBuffer)
        let audioUrl = window.URL.createObjectURL(outputWavBlob);
        let audioTag = $("#output-audio-tag");
        audioTag.src = audioUrl;
        audioTag.play();

        $("#download-output-audio-link").href = audioUrl;

        $("#voice-output-loader").style.display = "none";
        $("#voice-output-area").style.display = "";

        alreadyLoadingOutputAudio = false;
      }


      async function loadExampleAudio(name) {
        document.querySelector("#audio-loading-input").style.display = "flex";
        let arrayBuffer = await (await fetch("/voicemaker/audio/"+name+".mp3")).arrayBuffer();
        let ctx = new AudioContext();
        globalAudioBuffer = await ctx.decodeAudioData(arrayBuffer);
        loadOutputAudio();
        document.querySelector("#audio-loading-input").style.display = "none";
        document.querySelector("#audio-load-success").style.display = "flex";
      }


      let maxFileSizeMegabytes = 100;
      function loadAudioFile(file) {
        let $ = document.querySelector.bind(document);

        if(file.size > maxFileSizeMegabytes*1000*1000) {
          if(!confirm("The audio file you're loading is quite large. Applying effects to it may take a long time, or may not work at all, depending on how powerful your computer is. Are you sure you want to continue? (If so, be aware that this webpage may lag for a while until it has fully loaded)")) {
            return;
          }
        }

        document.querySelector("#audio-loading-input").style.display = "flex";

        let reader = new FileReader();
        reader.onloadend = async function() {
          let arrayBuffer = this.result;
          try {
            globalAudioBuffer = await (new AudioContext()).decodeAudioData(arrayBuffer);
            $("#audio-load-success").style.display = "flex";
            document.querySelector("#audio-loading-input").style.display = "none";
            loadOutputAudio();
          } catch(e) {
            alert("Sorry, either that's not an audio file, or it's not an audio format that's supported by your browser. Most modern browsers support: wav, mp3, mp4, ogg, webm, flac. You should use Chrome or Firefox if you want the best audio support, and ensure you're using the *latest version* of your browser of choice. Chrome and Firefox update automatically, but you may need to completely close down the browser and potentially restart your device to 'force' it to update itself to the latest version. If you're using a work computer, or a school computer, they may have unfortunately \"locked\" the browser version to an older one.");
          }
        }
        reader.onerror = function (e) {
          alert("Sorry! There was an error reading that file: "+JSON.stringify(e));
        }

        reader.readAsArrayBuffer(file);

        // let types = ["audio/mp3", "audio/vnd.wave", "audio/wav", "audio/wave", "audio/x-wav", "audio/ogg", "audio/webm", "audio/aac", "audio/aacp", "audio/3gpp", "audio/3gpp2", "audio/mp4", "audio/mp4a-latm", "audio/mpeg4-generic", "audio/x-flac"];
        // if(true || types.includes(file.type)) { }

      }

      // Microphone
      let currentlyRecording = false;
      let maxRecordingSeconds = 5*60;
      async function recordFromMicrophone() {
        let $ = document.querySelector.bind(document);

        if(currentlyRecording) {
          return;
        }
        currentlyRecording = true;

        // Change, button, start timer:
        var micButtonCssText = $("#microphone-button").style.cssText;
        $("#microphone-button").style.cssText = "background:#e71010; color:white;";
        $("#microphone-button .start").style.cssText = "display:none;"
        $("#microphone-button .mic-enable").style.cssText = "display:initial;"

        let chunks = [];
        let stream = await navigator.mediaDevices.getUserMedia({ audio:true, video:false });
        let mediaRecorder = new MediaRecorder(stream, {mimeType:"video/webm"});

        mediaRecorder.start();
        let timerInterval;

        mediaRecorder.ondataavailable = function(e) { chunks.push(e.data); };
        mediaRecorder.onstart = function() {
          console.log('Started, state = ',mediaRecorder.state);

          $("#microphone-button .mic-enable").style.cssText = "display:none;";
          $("#microphone-button .stop").style.cssText = "display:initial;";

          var seconds = 0;
          $("#microphone-button .time").innerText = seconds;
          timerInterval = setInterval(() => { seconds++; $("#microphone-button .time").innerText = seconds; }, 1000);


          let stopFn = function() {
            mediaRecorder.stop();
            $("#microphone-button").removeEventListener("click", stopFn);
            clearTimeout(maxLengthTimeout);
          };
          $("#microphone-button").addEventListener("click", stopFn)
          let maxLengthTimeout = setTimeout(stopFn, maxRecordingSeconds*1000);

        };

        mediaRecorder.onerror = function(e) { console.log('Error: ',e); };
        mediaRecorder.onwarning = function(e) { console.log('Warning: ', e); };

        mediaRecorder.onstop = async function() {
          console.log('Stopped, state = ' + mediaRecorder.state);

          let blob = new Blob(chunks, { type: mediaRecorder.mimeType });//+'; codecs=opus' });//
          let audioURL = window.URL.createObjectURL(blob);

          // let audio = document.createElement('audio');
          // audio.src = audioURL;
          // document.body.appendChild(audio);
          // audio.play();

          let arrayBuffer = await (await fetch(audioURL)).arrayBuffer();

          try {
            globalAudioBuffer = await (new AudioContext()).decodeAudioData(arrayBuffer);
            $("#audio-load-success").style.display = "flex";
            loadOutputAudio();
          } catch(e) {
            alert("Sorry, your browser doesn't support a crucial feature needed to allow you to record using your device's microphone. You should use Chrome or Firefox if you want the best audio support, and ensure you're using the *latest version* of your browser of choice. Chrome and Firefox update automatically, but you may need to completely close down the browser and potentially restart your device to 'force' it to update itself to the latest version.");
          }

          // Change, button, end timer:
          $("#microphone-button").style.cssText = micButtonCssText;
          $("#microphone-button .start").style.cssText = "display:initial;";
          $("#microphone-button .stop").style.cssText = "display:none;";
          clearInterval(timerInterval);

          currentlyRecording = false;

        }


      }
    </script>


    <script src="/js/dragula.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/dragula.min.css">

    <script src="/js/helpers.js"></script>
    <script src="js/jungle.js"></script>
    <script src="js/vocoder.js"></script>
    <script src="js/tuna.min.js"></script>

    <script>self.AudioContext = (self.AudioContext || self.webkitAudioContext);</script>

    <script src="/transformers/pitchShiftTransformer.js"></script>
    <script src="/transformers/deepScaryTransformer.js"></script> 
    <script src="/transformers/ringModulatorTransformer.js"></script>
    <script src="/transformers/giantRobotTransformer.js"></script>
    <script src="/transformers/tinyRobotTransformer.js"></script>
    <script src="/transformers/alienRobotTransformer.js"></script>
    <script src="/transformers/beepBoopRobotTransformer.js"></script>
    <script src="/transformers/roboticTransformer.js"></script>
    <script src="/transformers/megaphoneTransformer.js"></script>
    <script src="/transformers/distopianPATransformer.js"></script>
    <script src="/transformers/reverseReverbTransformer.js"></script>
    <script src="/transformers/churchEchoTransformer.js"></script>
    <script src="/transformers/telephoneTransformer.js"></script>
    <script src="/transformers/wobbleTransformer.js"></script>
    <script src="/transformers/anonymousTransformer.js"></script>
    <script src="/transformers/reverseTimeTransformer.js"></script>
    <script src="/transformers/oldRadioTransformer.js"></script>
    <script src="/transformers/cymbalConvolverTransformer.js"></script>
    <script src="/transformers/autowahTransformer.js"></script>
    <script src="/transformers/vibratoTransformer.js"></script>
    <script src="/transformers/longEchoTransformer.js"></script>
    <script src="/transformers/generalRobotTransformer.js"></script>
    <script src="/transformers/speedTransformer.js"></script>
    <script src="/transformers/veryDistortedRadioTransformer.js"></script>
    <script src="/transformers/shuffleChunksTransformer.js"></script>
    <script src="/transformers/flipDistortionTransformer.js"></script>
    <script src="/transformers/signalInterferanceTransformer.js"></script>
    <script src="/transformers/giantMonsterTransformer.js"></script>
    <script src="/transformers/mirroredChunksTransformer.js"></script>
    <script src="/transformers/satanTransformer.js"></script>
    <script src="/transformers/astronautTransformer.js"></script>
    <script src="/transformers/synthTransformer.js"></script>
    <script src="/transformers/evilRobotTransformer.js"></script>
    <script src="/transformers/phaserTransformer.js"></script>
    <script src="/transformers/biquadFilterTransformer.js"></script>
    <script src="/transformers/overdriveTransformer.js"></script>
    <script src="/transformers/chorusTransformer.js"></script>
    <script src="/transformers/delayTransformer.js"></script>
    <script src="/transformers/overdrive2Transformer.js"></script>
    <script src="/transformers/wahWahTransformer.js"></script>
    <script src="/transformers/bitcrusherTransformer.js"></script>
    <script src="/transformers/moogFilterTransformer.js"></script>
    <script src="/transformers/tremoloTransformer.js"></script>
    <script src="/transformers/compressorTransformer.js"></script>
    <script src="/transformers/vowelFilterTransformer.js"></script>
    <script src="/transformers/gainTransformer.js"></script> 

    <script>
      console.log(`Notes:
       - remember that if you change voices, it will "break" links
      `);
    </script>

    <script>
      dragula([effectsList], {
        moves: function (el, container, handle) {
          return handle.classList.contains('handle');
        }
      }).on('drop', function (el) {
        console.log("drop:", el);
        updateEffectsData();
      });
    </script>

    <style>
      .lds-ring { display: inline-block; position: relative; width: 64px; height: 64px; }
      .lds-ring div { box-sizing: border-box; display: block; position: absolute; width: 51px; height: 51px; margin: 6px; border: 6px solid #444; border-radius: 50%; animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite; border-color: #444 transparent transparent transparent; }
      .lds-ring div:nth-child(1) { animation-delay: -0.45s; }
      .lds-ring div:nth-child(2) { animation-delay: -0.3s; }
      .lds-ring div:nth-child(3) { animation-delay: -0.15s; }
      @keyframes lds-ring { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
      
    <script>
      loadingEffectsNotice.remove();
    </script>


    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-36798824-23', 'auto');
      ga('send', 'pageview');
    </script>

    <script>
      // COMPATABILITY TESTING:
      try {

        var str = "";
        str += "\n(async () => { await new Promise(resolve => setTimeout(resolve, 500)); console.log('async/await is supported'); })();";
        str += "\nlet arr = [1,2,3]; for(let a of arr) { arr[0]+=a; }; console.log('let a of arr supported');";
        str += "\nvar m = [1,2,3].map(n => n+1); console.log('arrow functions supported');";
        str += "\nvar k = [...[1,2,3]]; console.log('spreading supported');";
        str += "\nvar a = (function(a=3) { return a+1; })(); console.log('default arguments supported');";

        window.eval(str);

      } catch(e) {
        var message = "(„ÄçÔæüÔæõÔæü)ÔΩ£ Sorry! VoiceChanger.io uses cutting edge browser features that are only available in the latest versions of Chrome and Firefox. All modern browsers will eventually be supported, but for now you'll need to use one of those two. Sorry again for the inconvenience!";
        window.alert(message);
      }
    </script>


    <!-- <script src="/upup.min.js"></script> -->
    <script>
      // UpUp.start({
      //   'content-url': '/maker',
      //   'assets': [
      //     'normalize.min.css',
      //   ]
      // });
    </script>
    
    <p style="text-align:center;"><a href="/privacy">Privacy Policy</a></p>

  </body>
</html>
